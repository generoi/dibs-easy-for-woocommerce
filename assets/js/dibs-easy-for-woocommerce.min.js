jQuery((function(e){if("undefined"==typeof wcDibsEasy)return!1;var o={bodyEl:e("body"),paymentMethodEl:e('input[name="payment_method"]'),dibsCheckout:null,blocked:!1,selectAnotherSelector:"#dibs-easy-select-other",checkout_initiated:wcDibsEasy.checkoutInitiated,dibsOrderProcessing:!1,checkoutFormSelector:"form.checkout",standardWooFields:wcDibsEasy.standard_woo_checkout_fields,wooTerms:"form.checkout #terms",init:function(){e(document).ready(o.loadDibs),o.bodyEl.on("change",'input[name="payment_method"]',o.maybeChangeToDibsEasy),o.bodyEl.on("click",o.selectAnotherSelector,o.changeFromDibsEasy)},dibsIsSelected:function(){return o.paymentMethodEl.length>0&&(o.paymentMethod=o.paymentMethodEl.filter(":checked").val(),"dibs_easy"===o.paymentMethod)},loadDibs:function(){o.dibsIsSelected()&&(window.addEventListener("hashchange",o.handleHashChange),o.moveExtraCheckoutFields(),o.initDibsCheckout())},payInitialized:function(t){o.dibsOrderProcessing=!0,e(document.body).trigger("dibs_pay_initialized"),console.log("dibs_pay_initialized"),console.log(t),o.getDibsEasyOrder()},paymentCompleted:function(e){console.log("payment-completed"),console.log(e.paymentId);var o=sessionStorage.getItem("DIBSRedirectUrl");console.log(o),o&&(window.location.href=o)},displayMustLoginError:function(e){var t='<div class="'.concat("woocommerce-NoticeGroupwoocommerce-NoticeGroup-updateOrderReview",'">\n\t\t\t\t<ul class="woocommerce-error" role="alert">\n\t\t\t\t\t<li>').concat(e,"</li>\n\t\t\t\t</ul>\n\t\t\t</div>");o.checkoutFormSelector.prepend(t)},updateAddress:function(t){if("yes"===t.updateNeeded&&(e("#billing_country").val(t.country),e("#shipping_country").val(t.country),e("#billing_postcode").val(t.postCode),e("#shipping_postcode").val(t.postCode)),"yes"===t.mustLogin){o.displayMustLoginError(t.mustLoginMessage),o.dibsCheckout.freezeCheckout();var c=o.checkoutFormSelector.offset().top;e("html, body").animate({scrollTop:c},1e3)}else o.dibsCheckout.thawCheckout(),e(document.body).trigger("update_checkout")},addressChanged:function(t){console.log("address is: ",t),t&&(console.log("address-changed"),console.log(t),e.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.customer_address_updated_url,data:{action:"customer_address_updated",address:t,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){},error:function(e){},complete:function(e){console.log("COMPLETED"),console.log("customer_address_updated "),console.log(e.responseJSON.data),o.updateAddress(e.responseJSON.data)}}))},initDibsCheckout:function(){o.dibsCheckout=new Dibs.Checkout({checkoutKey:wcDibsEasy.privateKey,paymentId:wcDibsEasy.dibs_payment_id,containerId:"dibs-complete-checkout",language:wcDibsEasy.locale}),o.dibsCheckout.on("pay-initialized",o.payInitialized),o.dibsCheckout.on("payment-completed",o.paymentCompleted),o.dibsCheckout.on("address-changed",o.addressChanged)},getDibsEasyOrder:function(){e.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.get_order_data_url,data:{action:"payment_success",paymentId:wcDibsEasy.paymentId,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){console.log(e),!1===e.success?(console.log("PaymentID already exist in order"),console.log(e),e.data.redirect&&(window.location.href=e.data.redirect)):o.setAddressData(e)},error:function(e){console.log(e,"error_data")},complete:function(e){}})},setAddressData:function(t){var c=t.data.payment.consumer,s=c.billingAddress,a=c.shippingAddress;if(e("#billing_address_1").val(s.addressLine1),e("#billing_postcode").val(s.postalCode),e("#billing_city").val(s.city),e("#billing_country").val(a.country),e("#shipping_address_1").val(a.addressLine1),e("#shipping_postcode").val(a.postalCode),e("#shipping_city").val(a.city),e("#shipping_country").val(a.country),c.company.hasOwnProperty("name")){var n=c.company,i=n.contactDetails,r=i.firstName,l=i.lastName,d=i.email,u=i.phoneNumber,m=u.prefix,p=u.number;e("#billing_company").val(n.name),e("#shipping_company").val(n.name),e("#billing_first_name").val(r),e("#billing_last_name").val(l),e("#shipping_first_name").val(r),e("#shipping_last_name").val(l),e("#billing_email").val(d),e("#billing_phone").val("".concat(m).concat(p))}else{var h=c.privatePerson,y=h.firstName,g=h.lastName,b=h.email,_=h.phoneNumber,f=_.prefix,k=_.number;e("#billing_company").val(""),e("#shipping_company").val(""),e("#billing_first_name").val(y),e("#billing_last_name").val(g),e("#shipping_first_name").val(y),e("#shipping_last_name").val(g),e("#billing_email").val(b),e("#billing_phone").val("".concat(f).concat(k))}null!=a.addressLine2&&(e("#billing_address_2").val(a.addressLine2),e("#shipping_address_2").val(a.addressLine2)),e(o.wooTerms).length>0&&e(o.wooTerms).prop("checked",!0),e("input#ship-to-different-address-checkbox").prop("checked",!0),e("form.woocommerce-checkout").append('<input \n\t\t\t\t\ttype="hidden"\n\t\t\t\t\tid="dibs_payment_id"\n\t\t\t\t\tname="dibs_payment_id"\n\t\t\t\t\tvalue="'.concat(wcDibsEasy.paymentId,'"\n\t\t\t\t/>')),o.submitOrder()},maybeChangeToDibsEasy:function(){"dibs_easy"===e(this).val()&&(e(".woocommerce-info").remove(),e(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",data:{nonce:wcDibsEasy.nets_checkout_nonce},dataType:"json",url:wcDibsEasy.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){window.location.href=e.responseJSON.data.redirect}}))},handleHashChange:function(){console.log("hashchange");var t=location.hash.split("=");if("#dibseasy"===t[0]){var c=JSON.parse(atob(t[1]));window.dibsRedirectUrl=c.redirect_url,console.log("response.return_url"),console.log(c.return_url),sessionStorage.setItem("DIBSRedirectUrl",c.return_url),e("#dibs-order-review").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e(o.checkoutFormSelector).removeClass("processing").unblock(),wcDibsEasy.dibsOrderProcessing=!1,o.dibsCheckout.send("payment-order-finalized",!0)}},submitOrder:function(){e(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",url:wcDibsEasy.submitOrder,data:e("form.checkout").serialize(),dataType:"json",success:function(e){try{if("success"!==e.result)throw"Result failed";o.logToFile("Successfully placed order."),window.location.href=e.redirect}catch(t){e.messages?(o.logToFile("Checkout error | "+e.messages),o.failOrder("submission",e.messages)):(o.logToFile("Checkout error | No message"),o.failOrder("submission",'<div class="woocommerce-error">Checkout error</div>'))}},error:function(e){o.failOrder()}})},changeFromDibsEasy:function(t){t.preventDefault(),e(o.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.ajax({type:"POST",dataType:"json",async:!0,url:wcDibsEasy.change_payment_method_url,data:{action:"dibs_change_payment_method",dibs_easy:!1,nonce:wcDibsEasy.nets_checkout_nonce},success:function(e){},error:function(e){},complete:function(e){console.log("Change payment method success"),console.log(e.responseJSON.data.redirect),o.bodyEl.removeClass("dibs-selected"),window.location.href=e.responseJSON.data.redirect}})},moveExtraCheckoutFields:function(){e(".woocommerce-additional-fields").appendTo("#dibs-extra-checkout-fields");for(var t=e('form[name="checkout"] input, form[name="checkout"] select, textarea'),c=0;c<t.length;c++){var s=t[c].name,a=o.standardWooFields;-1===e.inArray(s,a)&&e("p#"+s+"_field").appendTo("#dibs-extra-checkout-fields")}},logToFile:function(o){e.ajax({url:wcDibsEasy.log_to_file_url,type:"POST",dataType:"json",data:{message:o,nonce:wcDibsEasy.get_log_nonce}})},failOrder:function(t,c){var s='<div class="'.concat("woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout",'">').concat(c,"</div>");o.dibsCheckout.send("payment-order-finalized",!1),o.bodyEl.trigger("updated_checkout"),e(o.checkoutFormSelector).removeClass("processing"),e(o.checkoutFormSelector).unblock(),e(".woocommerce-checkout-review-order-table").unblock(),e(".woocommerce-NoticeGroup-checkout,.woocommerce-error,.woocommerce-message").remove(),e(o.checkoutFormSelector).prepend(s),e(o.checkoutFormSelector).removeClass("processing").unblock(),e(o.checkoutFormSelector).find(".input-text, select, input:checkbox").trigger("validate").blur(),e(document.body).trigger("checkout_error",[c]),e("html, body").animate({scrollTop:e(o.checkoutFormSelector).offset().top-100},1e3)}};o.init()}));
//# sourceMappingURL=dibs-easy-for-woocommerce.min.js.map