{"version":3,"file":"dibs-easy-for-woocommerce.min.js","mappings":"AAIAA,QAAQ,SAAUC,GACjB,GAA2B,oBAAfC,WACX,OAAO,EAOR,IAAMC,EAAyB,CAC9BC,OAAQH,EAAG,QACXI,gBAAiBJ,EAAG,gCACpBK,aAAc,KACdC,SAAS,EACTC,sBAAuB,0BACvBC,mBAAoBP,WAAWQ,kBAC/BC,qBAAqB,EACrBC,qBAAsB,gBACtBC,kBAAmBX,WAAWY,6BAC9BC,SAAU,uBAKVC,KAf8B,WAgB7Bf,EAAGgB,UAAWC,MAAOf,EAAuBgB,UAC5ChB,EAAuBC,OAAOgB,GAC7B,SACA,+BACAjB,EAAuBkB,uBAExBlB,EAAuBC,OAAOgB,GAC7B,QACAjB,EAAuBK,sBACvBL,EAAuBmB,qBAOzBC,eAhC8B,WAiC7B,OAAKpB,EAAuBE,gBAAgBmB,OAAS,IACpDrB,EAAuBsB,cACtBtB,EAAuBE,gBACrBqB,OAAQ,YACRC,MACE,cAAgBxB,EAAuBsB,gBAS9CN,SA/C8B,WAgDxBhB,EAAuBoB,mBAC3BK,OAAOC,iBACN,aACA1B,EAAuB2B,kBAExB3B,EAAuB4B,0BACvB5B,EAAuB6B,qBAQzBC,eA9D8B,SA8DdC,GACf/B,EAAuBQ,qBAAsB,EAC7CV,EAAGgB,SAASkB,MAAOC,QAAS,wBAC5BC,QAAQC,IAAK,wBACbD,QAAQC,IAAKJ,GACb/B,EAAuBoC,oBAOxBC,iBA1E8B,SA0EZN,GACjBG,QAAQC,IAAK,qBACbD,QAAQC,IAAKJ,EAASO,WAEtB,IAAMC,EAAcC,eAAeC,QAAS,mBAC5CP,QAAQC,IAAKI,GACRA,IACJd,OAAOiB,SAASC,KAAOJ,IASzBK,sBA1F8B,SA0FPC,GACtB,IACMC,EAAkB,eAAH,OADE,mEACF,kFAEZD,EAFY,sCAKrB7C,EAAuBS,qBAAqBsC,QAC3CD,IAQFE,cA1G8B,SA0GfC,GAQd,GAPK,QAAUA,EAAKC,eACnBpD,EAAG,oBAAqB0B,IAAKyB,EAAKE,SAClCrD,EAAG,qBAAsB0B,IAAKyB,EAAKE,SACnCrD,EAAG,qBAAsB0B,IAAKyB,EAAKG,UACnCtD,EAAG,sBAAuB0B,IAAKyB,EAAKG,WAGhC,QAAUH,EAAKI,UAAY,CAE/BrD,EAAuB4C,sBAAuBK,EAAKK,kBACnDtD,EAAuBG,aAAaoD,iBAEpC,IAAMC,EACLxD,EAAuBS,qBAAqBgD,SAASC,IACtD5D,EAAG,cAAe6D,QACjB,CACCC,UAAWJ,GAEZ,UAIDxD,EAAuBG,aAAa0D,eACpC/D,EAAGgB,SAASkB,MAAOC,QAAS,oBAQ9B6B,eA1I8B,SA0IdC,GACf7B,QAAQC,IAAK,eAAgB4B,GACxBA,IACJ7B,QAAQC,IAAK,mBACbD,QAAQC,IAAK4B,GACbjE,EAAEkE,KAAM,CACPC,KAAM,OACNC,SAAU,OACVC,OAAO,EACPC,IAAKrE,WAAWsE,6BAChBpB,KAAM,CACLqB,OAAQ,2BACRP,QAAAA,EACAQ,MAAOxE,WAAWyE,qBAEnBC,QAVO,SAUE1C,KACT2C,MAXO,SAWA3C,KACP4C,SAZO,SAYG5C,GACTG,QAAQC,IAAK,aACbD,QAAQC,IAAK,6BACbD,QAAQC,IAAKJ,EAAS6C,aAAa3B,MACnCjD,EAAuBgD,cACtBjB,EAAS6C,aAAa3B,WAS3BpB,iBAzK8B,WA2K7B7B,EAAuBG,aAAe,IAAI0E,KAAKC,SAAU,CACxDC,YAAahF,WAAWiF,WACxB1C,UAAWvC,WAAWkF,gBACtBC,YAAa,yBACbC,SAAUpF,WAAWqF,SAEtBpF,EAAuBG,aAAac,GACnC,kBACAjB,EAAuB8B,gBAExB9B,EAAuBG,aAAac,GACnC,oBACAjB,EAAuBqC,kBAExBrC,EAAuBG,aAAac,GACnC,kBACAjB,EAAuB8D,iBAMzB1B,iBAjM8B,WAkM7BtC,EAAEkE,KAAM,CACPC,KAAM,OACNC,SAAU,OACVC,OAAO,EACPC,IAAKrE,WAAWsF,mBAChBpC,KAAM,CACLqB,OAAQ,kBACRhC,UAAWvC,WAAWuC,UACtBiC,MAAOxE,WAAWyE,qBAEnBC,QAVO,SAUExB,GACRf,QAAQC,IAAKc,IACR,IAAUA,EAAKwB,SACnBvC,QAAQC,IAAK,oCACbD,QAAQC,IAAKc,GACRA,EAAKA,KAAKqC,WACd7D,OAAOiB,SAASC,KAAOM,EAAKA,KAAKqC,WAGlCtF,EAAuBuF,eAAgBtC,IAGzCyB,MAtBO,SAsBAzB,GACNf,QAAQC,IAAKc,EAAM,eAEpB0B,SAzBO,SAyBG1B,QAQZsC,eAnO8B,SAmOdtC,GACf,IAAMuC,EAAWvC,EAAKA,KAAKwC,QAAQD,SAC3BE,EAAoCF,EAApCE,eAAgBC,EAAoBH,EAApBG,gBAcxB,GAVA7F,EAAG,sBAAuB0B,IAAKkE,EAAeE,cAC9C9F,EAAG,qBAAsB0B,IAAKkE,EAAeG,YAC7C/F,EAAG,iBAAkB0B,IAAKkE,EAAeI,MACzChG,EAAG,oBAAqB0B,IAAKmE,EAAgBxC,SAE7CrD,EAAG,uBAAwB0B,IAAKmE,EAAgBC,cAChD9F,EAAG,sBAAuB0B,IAAKmE,EAAgBE,YAC/C/F,EAAG,kBAAmB0B,IAAKmE,EAAgBG,MAC3ChG,EAAG,qBAAsB0B,IAAKmE,EAAgBxC,SAEzCqC,EAASO,QAAQC,eAAgB,QAAW,CAEhD,IAAMD,EAAUP,EAASO,QACzB,EAAoDA,EAAQE,eAApDC,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,SAAUC,EAA7B,EAA6BA,MAAOC,EAApC,EAAoCA,YAC5BC,EAAmBD,EAAnBC,OAAQC,EAAWF,EAAXE,OAChBzG,EAAG,oBAAqB0B,IAAKuE,EAAQS,MACrC1G,EAAG,qBAAsB0B,IAAKuE,EAAQS,MACtC1G,EAAG,uBAAwB0B,IAAK0E,GAChCpG,EAAG,sBAAuB0B,IAAK2E,GAC/BrG,EAAG,wBAAyB0B,IAAK0E,GACjCpG,EAAG,uBAAwB0B,IAAK2E,GAChCrG,EAAG,kBAAmB0B,IAAK4E,GAC3BtG,EAAG,kBAAmB0B,IAAtB,UAA+B8E,GAA/B,OAA0CC,QACpC,CAEN,MAAoDf,EAASiB,cAArDP,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,SAAUC,EAA7B,EAA6BA,MAAOC,EAApC,EAAoCA,YAC5BC,EAAmBD,EAAnBC,OAAQC,EAAWF,EAAXE,OAChBzG,EAAG,oBAAqB0B,IAAK,IAC7B1B,EAAG,qBAAsB0B,IAAK,IAC9B1B,EAAG,uBAAwB0B,IAAK0E,GAChCpG,EAAG,sBAAuB0B,IAAK2E,GAC/BrG,EAAG,wBAAyB0B,IAAK0E,GACjCpG,EAAG,uBAAwB0B,IAAK2E,GAChCrG,EAAG,kBAAmB0B,IAAK4E,GAC3BtG,EAAG,kBAAmB0B,IAAtB,UAA+B8E,GAA/B,OAA0CC,IAIN,MAAhCZ,EAAgBe,eACpB5G,EAAG,sBAAuB0B,IACzBmE,EAAgBe,cAEjB5G,EAAG,uBAAwB0B,IAC1BmE,EAAgBe,eAKb5G,EAAGE,EAAuBY,UAAWS,OAAS,GAClDvB,EAAGE,EAAuBY,UAAW+F,KAAM,WAAW,GAEvD7G,EAAG,4CAA6C6G,KAAM,WAAW,GACjE7G,EAAG,6BAA8B8G,OAAjC,+HAKY7G,WAAWuC,UALvB,kBAQAtC,EAAuB6G,eAMxB3F,sBA3S8B,WA4SxB,cAAgBpB,EAAGgH,MAAOtF,QAC9B1B,EAAG,qBAAsBiH,SACzBjH,EAAGE,EAAuBS,sBAAuBuG,MAAO,CACvDnE,QAAS,KACToE,WAAY,CACXC,WAAY,OACZC,QAAS,MAGXrH,EAAEkE,KAAM,CACPC,KAAM,OACNhB,KAAM,CACLsB,MAAOxE,WAAWyE,qBAEnBN,SAAU,OACVE,IAAKrE,WAAWqH,0BAChB3C,QAPO,SAOExB,KACTyB,MARO,SAQAzB,KACP0B,SATO,SASG1B,GACTxB,OAAOiB,SAASC,KAAOM,EAAK2B,aAAa3B,KAAKqC,cAQlD3D,iBAvU8B,WAwU7BO,QAAQC,IAAK,cACb,IACMkF,EADc3E,SAAS4E,KACIC,MAAO,KACxC,GAA2B,cAAtBF,EAAc,GAAsB,CACxC,IAAMtF,EAAWyF,KAAKC,MAAOC,KAAML,EAAc,KACjD5F,OAAOkG,gBAAkB5F,EAAS6F,aAClC1F,QAAQC,IAAK,uBACbD,QAAQC,IAAKJ,EAAS8F,YACtBrF,eAAesF,QAAS,kBAAmB/F,EAAS8F,YACpD/H,EAAG,sBAAuBkH,MAAO,CAChCnE,QAAS,KACToE,WAAY,CACXC,WAAY,OACZC,QAAS,MAGXrH,EAAGE,EAAuBS,sBAAuBsH,YAAa,cAAeC,UAC7EjI,WAAWS,qBAAsB,EACjCR,EAAuBG,aAAa8H,KACnC,2BACA,KAOHpB,YAnW8B,WAoW7B/G,EAAG,4CAA6CkH,MAAO,CACtDnE,QAAS,KACToE,WAAY,CACXC,WAAY,OACZC,QAAS,MAGXrH,EAAEkE,KAAM,CACPC,KAAM,OACNG,IAAKrE,WAAW8G,YAChB5D,KAAMnD,EAAG,iBAAkBoI,YAC3BhE,SAAU,OACVO,QALO,SAKExB,GACR,IACC,GAAK,YAAcA,EAAKkF,OAMvB,KAAM,gBALNnI,EAAuBoI,UACtB,8BAED3G,OAAOiB,SAASC,KAAOM,EAAKqC,SAI5B,MAAQ+C,GACJpF,EAAKqF,UACTtI,EAAuBoI,UACtB,oBAAsBnF,EAAKqF,UAE5BtI,EAAuBuI,UACtB,aACAtF,EAAKqF,YAGNtI,EAAuBoI,UACtB,+BAEDpI,EAAuBuI,UACtB,aACA,0DAOJ7D,MArCO,SAqCAzB,GACNjD,EAAuBuI,gBAS1BpH,mBA1Z8B,SA0ZVqH,GACnBA,EAAEC,iBACF3I,EAAGE,EAAuBS,sBAAuBuG,MAAO,CACvDnE,QAAS,KACToE,WAAY,CACXC,WAAY,OACZC,QAAS,MAGXrH,EAAEkE,KAAM,CACPC,KAAM,OACNC,SAAU,OACVC,OAAO,EACPC,IAAKrE,WAAWqH,0BAChBnE,KAAM,CACLqB,OAAQ,6BACRoE,WAAW,EACXnE,MAAOxE,WAAWyE,qBAEnBC,QAVO,SAUExB,KACTyB,MAXO,SAWAzB,KACP0B,SAZO,SAYG1B,GACTf,QAAQC,IAAK,iCACbD,QAAQC,IAAKc,EAAK2B,aAAa3B,KAAKqC,UACpCtF,EAAuBC,OAAO8H,YAAa,iBAC3CtG,OAAOiB,SAASC,KAAOM,EAAK2B,aAAa3B,KAAKqC,aAOjD1D,wBA1b8B,WA4b7B9B,EAAG,kCAAmC6I,SACrC,+BAMD,IAHA,IAAMC,EAAO9I,EACZ,uEAES+I,EAAI,EAAGA,EAAID,EAAKvH,OAAQwH,IAAM,CACvC,IAAMrC,EAAOoC,EAAMC,GAAIrC,KACjBsC,EAAS9I,EAAuBU,mBAEF,IAA/BZ,EAAEiJ,QAASvC,EAAMsC,IAErBhJ,EAAG,KAAO0G,EAAO,UAAWmC,SAC3B,iCAUJP,UApd8B,SAodnBvF,GACV/C,EAAEkE,KAAM,CACPI,IAAKrE,WAAWiJ,gBAChB/E,KAAM,OACNC,SAAU,OACVjB,KAAM,CACLJ,QAAAA,EACA0B,MAAOxE,WAAWkJ,kBAUrBV,UAre8B,SAqenBW,EAAOC,GACjB,IACMC,EAAe,eAAH,OADG,2DACH,aAAsCD,EAAtC,UAGlBnJ,EAAuBG,aAAa8H,KACnC,2BACA,GAGDjI,EAAuBC,OAAOgC,QAAS,oBACvCnC,EAAGE,EAAuBS,sBAAuBsH,YAChD,cAEDjI,EAAGE,EAAuBS,sBAAuBuH,UACjDlI,EAAG,4CAA6CkI,UAGhDlI,EAAG,6EAGDiH,SAEFjH,EAAGE,EAAuBS,sBAAuBsC,QAASqG,GAC1DtJ,EAAGE,EAAuBS,sBACxBsH,YAAa,cACbC,UACFlI,EAAGE,EAAuBS,sBACxB4I,KAAM,uCACNpH,QAAS,YACTqH,OACFxJ,EAAGgB,SAASkB,MAAOC,QAAS,iBAAkB,CAAEkH,IAChDrJ,EAAG,cAAe6D,QACjB,CACCC,UACC9D,EAAGE,EAAuBS,sBAAuBgD,SAC/CC,IAAM,KAEV,OAKH1D,EAAuBa","sources":["webpack://dibs-easy-for-woocommerce/./assets/js/dibs-easy-for-woocommerce.js"],"sourcesContent":["/**\n * @member wcDibsEasy\n *\n */\njQuery( function( $ ) {\n\tif ( typeof wcDibsEasy === 'undefined' ) {\n\t\treturn false;\n\t}\n\t/**\n\t * The main object.\n\t *\n\t * @type {Object} dibsEasyForWoocommerce\n\t */\n\tconst dibsEasyForWoocommerce = {\n\t\tbodyEl: $( 'body' ),\n\t\tpaymentMethodEl: $( 'input[name=\"payment_method\"]' ),\n\t\tdibsCheckout: null,\n\t\tblocked: false,\n\t\tselectAnotherSelector: '#dibs-easy-select-other',\n\t\tcheckout_initiated: wcDibsEasy.checkoutInitiated,\n\t\tdibsOrderProcessing: false,\n\t\tcheckoutFormSelector: 'form.checkout',\n\t\tstandardWooFields: wcDibsEasy.standard_woo_checkout_fields,\n\t\twooTerms: 'form.checkout #terms',\n\n\t\t/**\n\t\t * Initialize the gateway\n\t\t */\n\t\tinit() {\n\t\t\t$( document ).ready( dibsEasyForWoocommerce.loadDibs );\n\t\t\tdibsEasyForWoocommerce.bodyEl.on(\n\t\t\t\t'change',\n\t\t\t\t'input[name=\"payment_method\"]',\n\t\t\t\tdibsEasyForWoocommerce.maybeChangeToDibsEasy\n\t\t\t);\n\t\t\tdibsEasyForWoocommerce.bodyEl.on(\n\t\t\t\t'click',\n\t\t\t\tdibsEasyForWoocommerce.selectAnotherSelector,\n\t\t\t\tdibsEasyForWoocommerce.changeFromDibsEasy\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Check if DIBS Easy is the selected gateway.\n\t\t */\n\t\tdibsIsSelected() {\n\t\t\tif ( dibsEasyForWoocommerce.paymentMethodEl.length > 0 ) {\n\t\t\t\tdibsEasyForWoocommerce.paymentMethod =\n\t\t\t\t\tdibsEasyForWoocommerce.paymentMethodEl\n\t\t\t\t\t\t.filter( ':checked' )\n\t\t\t\t\t\t.val();\n\t\t\t\tif ( 'dibs_easy' === dibsEasyForWoocommerce.paymentMethod ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * Triggers on document ready.\n\t\t */\n\t\tloadDibs() {\n\t\t\tif ( dibsEasyForWoocommerce.dibsIsSelected() ) {\n\t\t\t\twindow.addEventListener(\n\t\t\t\t\t'hashchange',\n\t\t\t\t\tdibsEasyForWoocommerce.handleHashChange\n\t\t\t\t);\n\t\t\t\tdibsEasyForWoocommerce.moveExtraCheckoutFields();\n\t\t\t\tdibsEasyForWoocommerce.initDibsCheckout();\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Triggers when customer clicks the pay button.\n\t\t *\n\t\t * @param {Object} response\n\t\t */\n\t\tpayInitialized( response ) {\n\t\t\tdibsEasyForWoocommerce.dibsOrderProcessing = true;\n\t\t\t$( document.body ).trigger( 'dibs_pay_initialized' );\n\t\t\tconsole.log( 'dibs_pay_initialized' );\n\t\t\tconsole.log( response );\n\t\t\tdibsEasyForWoocommerce.getDibsEasyOrder();\n\t\t},\n\t\t/**\n\t\t * Triggers after a successful payment.\n\t\t *\n\t\t * @param {Object} response\n\t\t */\n\t\tpaymentCompleted( response ) {\n\t\t\tconsole.log( 'payment-completed' );\n\t\t\tconsole.log( response.paymentId );\n\t\t\t//DIBS_Payment_Success(response.paymentId);\n\t\t\tconst redirectUrl = sessionStorage.getItem( 'DIBSRedirectUrl' );\n\t\t\tconsole.log( redirectUrl );\n\t\t\tif ( redirectUrl ) {\n\t\t\t\twindow.location.href = redirectUrl;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t *  Display login error\n\t\t *\n\t\t * @param {string} message\n\t\t */\n\t\tdisplayMustLoginError( message ) {\n\t\t\tconst mustLoginClass = 'woocommerce-NoticeGroupwoocommerce-NoticeGroup-updateOrderReview';\n\t\t\tconst mustLoginNotice = `<div class=\"${ mustLoginClass }\">\n\t\t\t\t<ul class=\"woocommerce-error\" role=\"alert\">\n\t\t\t\t\t<li>${ message }</li>\n\t\t\t\t</ul>\n\t\t\t</div>`;\n\t\t\tdibsEasyForWoocommerce.checkoutFormSelector.prepend(\n\t\t\t\tmustLoginNotice\n\t\t\t);\n\t\t},\n\t\t/**\n\t\t * Update WC form if needed\n\t\t *\n\t\t * @param {Object} data\n\t\t */\n\t\tupdateAddress( data ) {\n\t\t\tif ( 'yes' === data.updateNeeded ) {\n\t\t\t\t$( '#billing_country' ).val( data.country );\n\t\t\t\t$( '#shipping_country' ).val( data.country );\n\t\t\t\t$( '#billing_postcode' ).val( data.postCode );\n\t\t\t\t$( '#shipping_postcode' ).val( data.postCode );\n\t\t\t}\n\n\t\t\tif ( 'yes' === data.mustLogin ) {\n\t\t\t\t// Customer might need to log in. Inform customer and freeze DIBS checkout.\n\t\t\t\tdibsEasyForWoocommerce.displayMustLoginError( data.mustLoginMessage );\n\t\t\t\tdibsEasyForWoocommerce.dibsCheckout.freezeCheckout();\n\n\t\t\t\tconst etop =\n\t\t\t\t\tdibsEasyForWoocommerce.checkoutFormSelector.offset().top;\n\t\t\t\t$( 'html, body' ).animate(\n\t\t\t\t\t{\n\t\t\t\t\t\tscrollTop: etop,\n\t\t\t\t\t},\n\t\t\t\t\t1000\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// All good release checkout and trigger update_checkout event\n\t\t\t\tdibsEasyForWoocommerce.dibsCheckout.thawCheckout();\n\t\t\t\t$( document.body ).trigger( 'update_checkout' );\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Triggers whenever customer updates address information\n\t\t *\n\t\t * @param {Object} address\n\t\t */\n\t\taddressChanged( address ) {\n\t\t\tconsole.log( 'address is: ', address );\n\t\t\tif ( address ) {\n\t\t\t\tconsole.log( 'address-changed' );\n\t\t\t\tconsole.log( address );\n\t\t\t\t$.ajax( {\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\tasync: true,\n\t\t\t\t\turl: wcDibsEasy.customer_address_updated_url,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\taction: 'customer_address_updated',\n\t\t\t\t\t\taddress,\n\t\t\t\t\t\tnonce: wcDibsEasy.nets_checkout_nonce,\n\t\t\t\t\t},\n\t\t\t\t\tsuccess( response ) {},\n\t\t\t\t\terror( response ) {},\n\t\t\t\t\tcomplete( response ) {\n\t\t\t\t\t\tconsole.log( 'COMPLETED' );\n\t\t\t\t\t\tconsole.log( 'customer_address_updated ' );\n\t\t\t\t\t\tconsole.log( response.responseJSON.data );\n\t\t\t\t\t\tdibsEasyForWoocommerce.updateAddress(\n\t\t\t\t\t\t\tresponse.responseJSON.data\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Init Dibs Easy Checkout\n\t\t */\n\t\tinitDibsCheckout() {\n\t\t\t// Constructs a new Checkout object.\n\t\t\tdibsEasyForWoocommerce.dibsCheckout = new Dibs.Checkout( {\n\t\t\t\tcheckoutKey: wcDibsEasy.privateKey,\n\t\t\t\tpaymentId: wcDibsEasy.dibs_payment_id,\n\t\t\t\tcontainerId: 'dibs-complete-checkout',\n\t\t\t\tlanguage: wcDibsEasy.locale,\n\t\t\t} );\n\t\t\tdibsEasyForWoocommerce.dibsCheckout.on(\n\t\t\t\t'pay-initialized',\n\t\t\t\tdibsEasyForWoocommerce.payInitialized\n\t\t\t);\n\t\t\tdibsEasyForWoocommerce.dibsCheckout.on(\n\t\t\t\t'payment-completed',\n\t\t\t\tdibsEasyForWoocommerce.paymentCompleted\n\t\t\t);\n\t\t\tdibsEasyForWoocommerce.dibsCheckout.on(\n\t\t\t\t'address-changed',\n\t\t\t\tdibsEasyForWoocommerce.addressChanged\n\t\t\t);\n\t\t},\n\t\t/**\n\t\t * Gets the Dibs Easy order and starts the order submission\n\t\t */\n\t\tgetDibsEasyOrder() {\n\t\t\t$.ajax( {\n\t\t\t\ttype: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tasync: true,\n\t\t\t\turl: wcDibsEasy.get_order_data_url,\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'payment_success',\n\t\t\t\t\tpaymentId: wcDibsEasy.paymentId,\n\t\t\t\t\tnonce: wcDibsEasy.nets_checkout_nonce,\n\t\t\t\t},\n\t\t\t\tsuccess( data ) {\n\t\t\t\t\tconsole.log( data );\n\t\t\t\t\tif ( false === data.success ) {\n\t\t\t\t\t\tconsole.log( 'PaymentID already exist in order' );\n\t\t\t\t\t\tconsole.log( data );\n\t\t\t\t\t\tif ( data.data.redirect ) {\n\t\t\t\t\t\t\twindow.location.href = data.data.redirect;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdibsEasyForWoocommerce.setAddressData( data );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror( data ) {\n\t\t\t\t\tconsole.log( data, 'error_data' );\n\t\t\t\t},\n\t\t\t\tcomplete( data ) {},\n\t\t\t} );\n\t\t},\n\t\t/**\n\t\t * Sets the customer data.\n\t\t *\n\t\t * @param {Object} data\n\t\t */\n\t\tsetAddressData( data ) {\n\t\t\tconst consumer = data.data.payment.consumer;\n\t\t\tconst { billingAddress, shippingAddress } = consumer;\n\n\t\t\t// billingAddress have country with 3 letters.\n\n\t\t\t$( '#billing_address_1' ).val( billingAddress.addressLine1 );\n\t\t\t$( '#billing_postcode' ).val( billingAddress.postalCode );\n\t\t\t$( '#billing_city' ).val( billingAddress.city );\n\t\t\t$( '#billing_country' ).val( shippingAddress.country );\n\n\t\t\t$( '#shipping_address_1' ).val( shippingAddress.addressLine1 );\n\t\t\t$( '#shipping_postcode' ).val( shippingAddress.postalCode );\n\t\t\t$( '#shipping_city' ).val( shippingAddress.city );\n\t\t\t$( '#shipping_country' ).val( shippingAddress.country );\n\n\t\t\tif ( consumer.company.hasOwnProperty( 'name' ) ) {\n\t\t\t\t// B2B purchase\n\t\t\t\tconst company = consumer.company;\n\t\t\t\tconst { firstName, lastName, email, phoneNumber } = company.contactDetails;\n\t\t\t\tconst { prefix, number } = phoneNumber;\n\t\t\t\t$( '#billing_company' ).val( company.name );\n\t\t\t\t$( '#shipping_company' ).val( company.name );\n\t\t\t\t$( '#billing_first_name' ).val( firstName );\n\t\t\t\t$( '#billing_last_name' ).val( lastName );\n\t\t\t\t$( '#shipping_first_name' ).val( firstName );\n\t\t\t\t$( '#shipping_last_name' ).val( lastName );\n\t\t\t\t$( '#billing_email' ).val( email );\n\t\t\t\t$( '#billing_phone' ).val( `${ prefix }${ number }` );\n\t\t\t} else {\n\t\t\t\t// B2C purchase\n\t\t\t\tconst { firstName, lastName, email, phoneNumber } = consumer.privatePerson;\n\t\t\t\tconst { prefix, number } = phoneNumber;\n\t\t\t\t$( '#billing_company' ).val( '' );\n\t\t\t\t$( '#shipping_company' ).val( '' );\n\t\t\t\t$( '#billing_first_name' ).val( firstName );\n\t\t\t\t$( '#billing_last_name' ).val( lastName );\n\t\t\t\t$( '#shipping_first_name' ).val( firstName );\n\t\t\t\t$( '#shipping_last_name' ).val( lastName );\n\t\t\t\t$( '#billing_email' ).val( email );\n\t\t\t\t$( '#billing_phone' ).val( `${ prefix }${ number }` );\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line eqeqeq\n\t\t\tif ( shippingAddress.addressLine2 != null ) {\n\t\t\t\t$( '#billing_address_2' ).val(\n\t\t\t\t\tshippingAddress.addressLine2\n\t\t\t\t);\n\t\t\t\t$( '#shipping_address_2' ).val(\n\t\t\t\t\tshippingAddress.addressLine2\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Check Terms checkbox, if it exists\n\t\t\tif ( $( dibsEasyForWoocommerce.wooTerms ).length > 0 ) {\n\t\t\t\t$( dibsEasyForWoocommerce.wooTerms ).prop( 'checked', true );\n\t\t\t}\n\t\t\t$( 'input#ship-to-different-address-checkbox' ).prop( 'checked', true );\n\t\t\t$( 'form.woocommerce-checkout' ).append(\n\t\t\t\t`<input \n\t\t\t\t\ttype=\"hidden\"\n\t\t\t\t\tid=\"dibs_payment_id\"\n\t\t\t\t\tname=\"dibs_payment_id\"\n\t\t\t\t\tvalue=\"${ wcDibsEasy.paymentId }\"\n\t\t\t\t/>`\n\t\t\t);\n\t\t\tdibsEasyForWoocommerce.submitOrder();\n\t\t\t// $('form.woocommerce-checkout').addClass('processing');\n\t\t},\n\t\t/**\n\t\t * When the customer changes to Dibs Easy from other payment methods.\n\t\t */\n\t\tmaybeChangeToDibsEasy() {\n\t\t\tif ( 'dibs_easy' === $( this ).val() ) {\n\t\t\t\t$( '.woocommerce-info' ).remove();\n\t\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).block( {\n\t\t\t\t\tmessage: null,\n\t\t\t\t\toverlayCSS: {\n\t\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\t\topacity: 0.6,\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\t$.ajax( {\n\t\t\t\t\ttype: 'POST',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tnonce: wcDibsEasy.nets_checkout_nonce,\n\t\t\t\t\t},\n\t\t\t\t\tdataType: 'json',\n\t\t\t\t\turl: wcDibsEasy.change_payment_method_url,\n\t\t\t\t\tsuccess( data ) {},\n\t\t\t\t\terror( data ) {},\n\t\t\t\t\tcomplete( data ) {\n\t\t\t\t\t\twindow.location.href = data.responseJSON.data.redirect;\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Handle hashchange triggered when Woo order is created.\n\t\t */\n\t\thandleHashChange( ) {\n\t\t\tconsole.log( 'hashchange' );\n\t\t\tconst currentHash = location.hash;\n\t\t\tconst splintedHash = currentHash.split( '=' );\n\t\t\tif ( splintedHash[ 0 ] === '#dibseasy' ) {\n\t\t\t\tconst response = JSON.parse( atob( splintedHash[ 1 ] ) );\n\t\t\t\twindow.dibsRedirectUrl = response.redirect_url;\n\t\t\t\tconsole.log( 'response.return_url' );\n\t\t\t\tconsole.log( response.return_url );\n\t\t\t\tsessionStorage.setItem( 'DIBSRedirectUrl', response.return_url );\n\t\t\t\t$( '#dibs-order-review' ).block( {\n\t\t\t\t\tmessage: null,\n\t\t\t\t\toverlayCSS: {\n\t\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\t\topacity: 0.6,\n\t\t\t\t\t},\n\t\t\t\t} );\n\t\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).removeClass( 'processing' ).unblock();\n\t\t\t\twcDibsEasy.dibsOrderProcessing = false;\n\t\t\t\tdibsEasyForWoocommerce.dibsCheckout.send(\n\t\t\t\t\t'payment-order-finalized',\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Submit the order using the WooCommerce AJAX function.\n\t\t */\n\t\tsubmitOrder() {\n\t\t\t$( '.woocommerce-checkout-review-order-table' ).block( {\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6,\n\t\t\t\t},\n\t\t\t} );\n\t\t\t$.ajax( {\n\t\t\t\ttype: 'POST',\n\t\t\t\turl: wcDibsEasy.submitOrder,\n\t\t\t\tdata: $( 'form.checkout' ).serialize(),\n\t\t\t\tdataType: 'json',\n\t\t\t\tsuccess( data ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif ( 'success' === data.result ) {\n\t\t\t\t\t\t\tdibsEasyForWoocommerce.logToFile(\n\t\t\t\t\t\t\t\t'Successfully placed order.'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\twindow.location.href = data.redirect;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow 'Result failed';\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch ( err ) {\n\t\t\t\t\t\tif ( data.messages ) {\n\t\t\t\t\t\t\tdibsEasyForWoocommerce.logToFile(\n\t\t\t\t\t\t\t\t'Checkout error | ' + data.messages\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tdibsEasyForWoocommerce.failOrder(\n\t\t\t\t\t\t\t\t'submission',\n\t\t\t\t\t\t\t\tdata.messages\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdibsEasyForWoocommerce.logToFile(\n\t\t\t\t\t\t\t\t'Checkout error | No message'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tdibsEasyForWoocommerce.failOrder(\n\t\t\t\t\t\t\t\t'submission',\n\t\t\t\t\t\t\t\t'<div class=\"woocommerce-error\">' +\n\t\t\t\t\t\t\t\t\t'Checkout error' +\n\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\terror( data ) {\n\t\t\t\t\tdibsEasyForWoocommerce.failOrder();\n\t\t\t\t},\n\t\t\t} );\n\t\t},\n\t\t/**\n\t\t * When the customer changes from Dibs Easy to other payment methods.\n\t\t *\n\t\t * @param {Event} e\n\t\t */\n\t\tchangeFromDibsEasy( e ) {\n\t\t\te.preventDefault();\n\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).block( {\n\t\t\t\tmessage: null,\n\t\t\t\toverlayCSS: {\n\t\t\t\t\tbackground: '#fff',\n\t\t\t\t\topacity: 0.6,\n\t\t\t\t},\n\t\t\t} );\n\t\t\t$.ajax( {\n\t\t\t\ttype: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tasync: true,\n\t\t\t\turl: wcDibsEasy.change_payment_method_url,\n\t\t\t\tdata: {\n\t\t\t\t\taction: 'dibs_change_payment_method',\n\t\t\t\t\tdibs_easy: false,\n\t\t\t\t\tnonce: wcDibsEasy.nets_checkout_nonce,\n\t\t\t\t},\n\t\t\t\tsuccess( data ) {},\n\t\t\t\terror( data ) {},\n\t\t\t\tcomplete( data ) {\n\t\t\t\t\tconsole.log( 'Change payment method success' );\n\t\t\t\t\tconsole.log( data.responseJSON.data.redirect );\n\t\t\t\t\tdibsEasyForWoocommerce.bodyEl.removeClass( 'dibs-selected' );\n\t\t\t\t\twindow.location.href = data.responseJSON.data.redirect;\n\t\t\t\t},\n\t\t\t} );\n\t\t},\n\t\t/**\n\t\t * Moves all non-standard fields to the extra checkout fields.\n\t\t */\n\t\tmoveExtraCheckoutFields() {\n\t\t\t// Move order comments.\n\t\t\t$( '.woocommerce-additional-fields' ).appendTo(\n\t\t\t\t'#dibs-extra-checkout-fields'\n\t\t\t);\n\n\t\t\tconst form = $(\n\t\t\t\t'form[name=\"checkout\"] input, form[name=\"checkout\"] select, textarea'\n\t\t\t);\n\t\t\tfor ( let i = 0; i < form.length; i++ ) {\n\t\t\t\tconst name = form[ i ].name;\n\t\t\t\tconst fields = dibsEasyForWoocommerce.standardWooFields;\n\t\t\t\t// Check if this is a standard field.\n\t\t\t\tif ( $.inArray( name, fields ) === -1 ) {\n\t\t\t\t\t// This is not a standard Woo field, move to our div.\n\t\t\t\t\t$( 'p#' + name + '_field' ).appendTo(\n\t\t\t\t\t\t'#dibs-extra-checkout-fields'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Logs the message to the Dibs Easy log in WooCommerce.\n\t\t *\n\t\t * @param {string} message\n\t\t */\n\t\tlogToFile( message ) {\n\t\t\t$.ajax( {\n\t\t\t\turl: wcDibsEasy.log_to_file_url,\n\t\t\t\ttype: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tmessage,\n\t\t\t\t\tnonce: wcDibsEasy.get_log_nonce,\n\t\t\t\t},\n\t\t\t} );\n\t\t},\n\t\t/**\n\t\t * Fails the order with Dibs Easy on a checkout error and timeout.\n\t\t *\n\t\t * @param {string} event\n\t\t * @param {string} errorMessage\n\t\t */\n\t\tfailOrder( event, errorMessage ) {\n\t\t\tconst errorClasses = 'woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout';\n\t\t\tconst errorWrapper = `<div class=\"${ errorClasses }\">${ errorMessage }</div>`;\n\n\t\t\t// Send false and cancel\n\t\t\tdibsEasyForWoocommerce.dibsCheckout.send(\n\t\t\t\t'payment-order-finalized',\n\t\t\t\tfalse\n\t\t\t);\n\t\t\t// Renable the form.\n\t\t\tdibsEasyForWoocommerce.bodyEl.trigger( 'updated_checkout' );\n\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).removeClass(\n\t\t\t\t'processing'\n\t\t\t);\n\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).unblock();\n\t\t\t$( '.woocommerce-checkout-review-order-table' ).unblock();\n\n\t\t\t// Print error messages, and trigger checkout_error, and scroll to notices.\n\t\t\t$( '.woocommerce-NoticeGroup-checkout,' +\n\t\t\t\t'.woocommerce-error,' +\n\t\t\t\t'.woocommerce-message'\n\t\t\t).remove();\n\n\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).prepend( errorWrapper );\n\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector )\n\t\t\t\t.removeClass( 'processing' )\n\t\t\t\t.unblock();\n\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector )\n\t\t\t\t.find( '.input-text, select, input:checkbox' )\n\t\t\t\t.trigger( 'validate' )\n\t\t\t\t.blur();\n\t\t\t$( document.body ).trigger( 'checkout_error', [ errorMessage ] );\n\t\t\t$( 'html, body' ).animate(\n\t\t\t\t{\n\t\t\t\t\tscrollTop:\n\t\t\t\t\t\t$( dibsEasyForWoocommerce.checkoutFormSelector ).offset()\n\t\t\t\t\t\t\t.top - 100,\n\t\t\t\t},\n\t\t\t\t1000\n\t\t\t);\n\t\t},\n\t};\n\n\tdibsEasyForWoocommerce.init();\n} );\n"],"names":["jQuery","$","wcDibsEasy","dibsEasyForWoocommerce","bodyEl","paymentMethodEl","dibsCheckout","blocked","selectAnotherSelector","checkout_initiated","checkoutInitiated","dibsOrderProcessing","checkoutFormSelector","standardWooFields","standard_woo_checkout_fields","wooTerms","init","document","ready","loadDibs","on","maybeChangeToDibsEasy","changeFromDibsEasy","dibsIsSelected","length","paymentMethod","filter","val","window","addEventListener","handleHashChange","moveExtraCheckoutFields","initDibsCheckout","payInitialized","response","body","trigger","console","log","getDibsEasyOrder","paymentCompleted","paymentId","redirectUrl","sessionStorage","getItem","location","href","displayMustLoginError","message","mustLoginNotice","prepend","updateAddress","data","updateNeeded","country","postCode","mustLogin","mustLoginMessage","freezeCheckout","etop","offset","top","animate","scrollTop","thawCheckout","addressChanged","address","ajax","type","dataType","async","url","customer_address_updated_url","action","nonce","nets_checkout_nonce","success","error","complete","responseJSON","Dibs","Checkout","checkoutKey","privateKey","dibs_payment_id","containerId","language","locale","get_order_data_url","redirect","setAddressData","consumer","payment","billingAddress","shippingAddress","addressLine1","postalCode","city","company","hasOwnProperty","contactDetails","firstName","lastName","email","phoneNumber","prefix","number","name","privatePerson","addressLine2","prop","append","submitOrder","this","remove","block","overlayCSS","background","opacity","change_payment_method_url","splintedHash","hash","split","JSON","parse","atob","dibsRedirectUrl","redirect_url","return_url","setItem","removeClass","unblock","send","serialize","result","logToFile","err","messages","failOrder","e","preventDefault","dibs_easy","appendTo","form","i","fields","inArray","log_to_file_url","get_log_nonce","event","errorMessage","errorWrapper","find","blur"],"sourceRoot":""}